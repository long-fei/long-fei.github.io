<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Maven私有仓库搭建 · 陈龙飞</title><meta name="description" content="Maven私有仓库搭建 - Troy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.chenlongfei.cn/atom.xml" title="陈龙飞"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/friend" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="https://github.com/betroy" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Maven私有仓库搭建</h1><div class="post-info">Aug 6, 2016</div><div class="post-content"><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>在Android开发的世界中，依赖管理是每个开发人员不得不面对的问题，无论是外部的开源类库依赖，还是项目内部的模块间的依赖，都需要有效的管理。在Android中不仅可以依赖<code>module</code>、<code>so</code>、<code>jar</code>还可以依赖<code>aar</code>。既可引用远程仓库<code>jcenter()</code>、<code>mavenCentral()</code>、也可以引用私有仓库、本地仓库。使用Maven可以有效地解决依赖管理。<br><a id="more"></a></p>
<h4 id="Maven包"><a href="#Maven包" class="headerlink" title="Maven包"></a>Maven包</h4><ul>
<li><p>使用方式   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">  compile &apos;cn.sharesdk.onekeyshare:onekeyshare:1.0.0&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>包结构</p>
<p><img src="http://7xl2ut.com1.z0.glb.clouddn.com/images/2016-08-12_16:22:28.jpg" alt=""></p>
</li>
<li><p>POM文件，包含maven包的相关信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.sharesdk.onekeyshare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>onekeyshare<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>aar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Onekeyshare Aar Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">licenses</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">license</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>The Apache Software License, Version 2.0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">license</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">developer</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>troy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>troy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">developer</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Maven-仓库"><a href="#Maven-仓库" class="headerlink" title="Maven 仓库"></a>Maven 仓库</h4><p>Maven仓库用于存放Maven包，可以是本地的，远程的、私有的、公开的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        maven &#123; url &quot;https://jitpack.io&quot; &#125;</div><div class="line">        //私有maven仓库</div><div class="line">        maven &#123; url &quot;http://172.16.1.19:8081/repository/maven-releases/&quot; &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h4 id="使用Nexus搭建私有仓库"><a href="#使用Nexus搭建私有仓库" class="headerlink" title="使用Nexus搭建私有仓库"></a>使用Nexus搭建私有仓库</h4><ul>
<li><p>下载<a href="http://www.sonatype.com/download-oss-sonatype" target="_blank" rel="external">nexus</a>，选择<code>nexus-3.0.1-01-mac.tgz</code></p>
</li>
<li><p>解压文件，进入<code>nexus-3.0.1-01/bin</code>目录，输入<code>./nexus start</code>运行服务，nexus默认监听端口8081。</p>
</li>
<li><p>浏览器中访问<code>http://your ip:8081</code></p>
</li>
<li><p>nexus管理员主界面，默认帐号<code>admin</code>，密码<code>admin123</code></p>
<p><img src="http://7xl2ut.com1.z0.glb.clouddn.com/images/2016-08-12_16:45:57.jpg" alt=""></p>
</li>
<li><p>仓库类型<br>hosted，本地仓库，通常我们会部署自己的构件到这一类型的仓库。比如公司的第二方库。<br>proxy，代理仓库，它们被用来代理远程的公共仓库，如maven中央仓库。<br>group，仓库组，用来合并多个hosted/proxy仓库，当你的项目希望在多个repository使用资源时就不需要多次引用了，只需要引用一个group即可。</p>
</li>
</ul>
<h4 id="发布包到私有仓库"><a href="#发布包到私有仓库" class="headerlink" title="发布包到私有仓库"></a>发布包到私有仓库</h4><ul>
<li><p>使用方法参考<a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="external">chrisbanes/gradle-mvn-push </a>插件</p>
</li>
<li><p>在项目根目录新建<code>gradle.properties</code>文件</p>
</li>
<li><p>使用如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"># 项目名称</div><div class="line">PROJ_NAME=onekeyshare</div><div class="line">PROJ_ARTIFACTID=onekeyshare</div><div class="line">PROJ_POM_NAME=Onekeyshare Aar Repository</div><div class="line">POM_PACKAGING=aar</div><div class="line"></div><div class="line"># the following can move to ~/.gradle/gradle.properties</div><div class="line">NEXUS_USERNAME=admin</div><div class="line">NEXUS_PASSWORD=admin123</div><div class="line">RELEASE_REPOSITORY_URL=http://172.16.1.19:8081/repository/maven-releases/</div><div class="line">SNAPSHOT_REPOSITORY_URL=http://172.16.1.19:8081/repository/maven-snapshots/</div><div class="line"></div><div class="line"># 包信息</div><div class="line">PROJ_GROUP=cn.sharesdk.onekeyshare</div><div class="line">PROJ_VERSION=1.0.0</div><div class="line"></div><div class="line"># 项目的描述</div><div class="line">#PROJ_WEBSITEURL=</div><div class="line">#PROJ_ISSUETRACKERURL=</div><div class="line">#PROJ_VCSURL=</div><div class="line">#PROJ_DESCRIPTION=Simple and effective bug &amp; crash reporting tool for Android apps</div><div class="line"></div><div class="line"># Licence信息</div><div class="line">PROJ_LICENCE_NAME=The Apache Software License, Version 2.0</div><div class="line">PROJ_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt</div><div class="line">PROJ_LICENCE_DEST=repo</div><div class="line"></div><div class="line"># Developer 信息</div><div class="line">DEVELOPER_ID=troy</div><div class="line">DEVELOPER_NAME=troy</div><div class="line">DEVELOPER_EMAIL=chenlongfeiceo@gmail.com</div></pre></td></tr></table></figure>
</li>
<li><p>根目录下新建<code>gradle-mvn-push.gradle</code>文件</p>
</li>
<li><p>使用如下配置</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'maven'</span></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'signing'</span></div><div class="line"></div><div class="line"><span class="keyword">def</span> isReleaseBuild() &#123;</div><div class="line">  <span class="keyword">return</span> PROJ_VERSION.contains(<span class="string">"SNAPSHOT"</span>) == <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> getReleaseRepositoryUrl() &#123;</div><div class="line">  <span class="keyword">return</span> hasProperty(<span class="string">'RELEASE_REPOSITORY_URL'</span>) ? RELEASE_REPOSITORY_URL</div><div class="line">          : <span class="string">"https://oss.sonatype.org/service/local/staging/deploy/maven2/"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> getSnapshotRepositoryUrl() &#123;</div><div class="line">  <span class="keyword">return</span> hasProperty(<span class="string">'SNAPSHOT_REPOSITORY_URL'</span>) ? SNAPSHOT_REPOSITORY_URL</div><div class="line">          : <span class="string">"https://oss.sonatype.org/content/repositories/snapshots/"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> getRepositoryUsername() &#123;</div><div class="line">  <span class="keyword">return</span> hasProperty(<span class="string">'NEXUS_USERNAME'</span>) ? NEXUS_USERNAME</div><div class="line">          : <span class="string">""</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> getRepositoryPassword() &#123;</div><div class="line">  <span class="keyword">return</span> hasProperty(<span class="string">'NEXUS_PASSWORD'</span>) ? NEXUS_PASSWORD</div><div class="line">          : <span class="string">""</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">afterEvaluate &#123; project -&gt;</div><div class="line">  uploadArchives &#123;</div><div class="line">      repositories &#123;</div><div class="line">          mavenDeployer &#123;</div><div class="line">              beforeDeployment &#123; MavenDeployment deployment -&gt; signing.signPom(deployment) &#125;</div><div class="line"></div><div class="line">              pom.groupId = PROJ_GROUP</div><div class="line">              pom.artifactId = PROJ_ARTIFACTID</div><div class="line">              pom.version = PROJ_VERSION</div><div class="line"></div><div class="line">              repository(<span class="string">url:</span> getReleaseRepositoryUrl()) &#123;</div><div class="line">                  authentication(<span class="string">userName:</span> getRepositoryUsername(), <span class="string">password:</span> getRepositoryPassword())</div><div class="line">              &#125;</div><div class="line">              snapshotRepository(<span class="string">url:</span> getSnapshotRepositoryUrl()) &#123;</div><div class="line">                  authentication(<span class="string">userName:</span> getRepositoryUsername(), <span class="string">password:</span> getRepositoryPassword())</div><div class="line">              &#125;</div><div class="line"></div><div class="line">              pom.project &#123;</div><div class="line">                  name PROJ_POM_NAME</div><div class="line">                  packaging POM_PACKAGING</div><div class="line"><span class="comment">//                    description PROJ_DESCRIPTION</span></div><div class="line"><span class="comment">//                    url PROJ_WEBSITEURL</span></div><div class="line"></div><div class="line">                  scm &#123;</div><div class="line"><span class="comment">//                        url PROJ_VCSURL</span></div><div class="line">                      connection DEVELOPER_EMAIL</div><div class="line">                      developerConnection DEVELOPER_EMAIL</div><div class="line">                  &#125;</div><div class="line"></div><div class="line">                  licenses &#123;</div><div class="line">                      license &#123;</div><div class="line">                          name PROJ_LICENCE_NAME</div><div class="line">                          url PROJ_LICENCE_URL</div><div class="line">                          distribution PROJ_LICENCE_DEST</div><div class="line">                      &#125;</div><div class="line">                  &#125;</div><div class="line"></div><div class="line">                  developers &#123;</div><div class="line">                      developer &#123;</div><div class="line">                          id DEVELOPER_ID</div><div class="line">                          name DEVELOPER_NAME</div><div class="line">                      &#125;</div><div class="line">                  &#125;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  signing &#123;</div><div class="line">      required &#123; isReleaseBuild() &amp;&amp; gradle.taskGraph.hasTask(<span class="string">"uploadArchives"</span>) &#125;</div><div class="line">      sign configurations.archives</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  task androidJavadocs(<span class="string">type:</span> Javadoc) &#123;</div><div class="line">      source = android.sourceSets.main.java.srcDirs</div><div class="line">      classpath += project.files(android.getBootClasspath().join(File.pathSeparator))</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  task androidJavadocsJar(<span class="string">type:</span> Jar, <span class="string">dependsOn:</span> androidJavadocs) &#123;</div><div class="line">      classifier = <span class="string">'javadoc'</span></div><div class="line">      from androidJavadocs.destinationDir</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  task androidSourcesJar(<span class="string">type:</span> Jar) &#123;</div><div class="line">      classifier = <span class="string">'sources'</span></div><div class="line">      from android.sourceSets.main.java.sourceFiles</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  artifacts &#123;</div><div class="line">      archives androidSourcesJar</div><div class="line">      archives androidJavadocsJar</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>在<code>build.gradle</code>中使用插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apply from: &apos;../gradle-mvn-push.gradle&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>执行gradle task进行上传操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./gradlew clean build uploadArchives</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="查看已上传的maven包"><a href="#查看已上传的maven包" class="headerlink" title="查看已上传的maven包"></a>查看已上传的maven包</h4><p><img src="http://7xl2ut.com1.z0.glb.clouddn.com/images/2016-08-12_17:29:15.jpg" alt=""></p>
<h4 id="使用maven包"><a href="#使用maven包" class="headerlink" title="使用maven包"></a>使用maven包</h4><ul>
<li><p>声明私有仓库地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">maven &#123; url &quot;http://172.16.1.19:8081/repository/maven-releases/&quot; &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>使用maven包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> dependencies &#123;</div><div class="line">  compile &apos;cn.sharesdk.onekeyshare:onekeyshare:1.0.0&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2016/10/22/watch-faces/" class="prev">PREV</a><a href="/2016/07/29/liqi/" class="next">NEXT</a></div><div data-thread-key="2016/08/06/maven-private-repository/" data-title="Maven私有仓库搭建" data-url="http://www.chenlongfei.cn/2016/08/06/maven-private-repository/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"chenlongfei"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://www.chenlongfei.cn">Troy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-66384101-1",'auto');ga('send','pageview');</script></body></html>